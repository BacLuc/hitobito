- title "Anmeldung für #{@event}"

= entry_form(stacked: true, 
             submit_label: entry.new_record? ? 'Anmelden' : 'Speichern', 
             cancel_url_new: group_event_path(@group, @event)) do |f|


  - if params[:for_someone_else]
    = f.labeled_person_field(:person)
             
  = f.fields_for(:answers) do |fans|
    = render 'event/answers/fields', f: fans
    
  = f.labeled_text_area(:additional_information)
    
  -if entry.application && entry.new_record?
    -# once given, priorities may not be changed anymore 
    -# (@alternatives might not be in state application_open anymore in the future,
    -#  causing missing choices for the dropdown)
    = f.fields_for(:application) do |fap|
      - if @event.priorization? && @priority_2s.present?
        = field_set_tag 'Ausweichdaten' do
          %p Bitte gib weitere Kurse an, welche dir gehen würden.
          = fap.labeled_belongs_to_field(:priority_2_id)
          = fap.labeled_belongs_to_field(:priority_3_id)
          
          %h4 Informationen zu den Kursen
          %table.table
            - @alternatives.each do |event| 
              %tr{class: "#{'highlight' if event == @event}"}
                %td= event.label
                %td= event.dates_full
      - else
        -# This is required for correct rendering
        &nbsp;
